/*! For license information please see index.js.LICENSE.txt */
(()=>{"use strict";var e={amdO:{},n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}};function t(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}e.r({});const n=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t(this,"unImmutableData",{equal:function(e,t){return e===t},copy:function(e){return e}}),t(this,"list",{key:"_id",mapSimilarityForDiff:.6})}var n;return(n=[{key:"set",value:function(e){}}])&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(e.prototype,n),e}());var r=require("immutable"),i=e.n(r),o=require("kind-of"),u=e.n(o);r=require("isobject"),o=e.n(r);const a=new(function(){function e(){var t,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),n={},(t="cache")in this?Object.defineProperty(this,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):this[t]=n}var t;return(t=[{key:"set",value:function(e,t,n){i().isImmutable(e)&&i().isImmutable(t)?this.cache[i().hash(e)+"_"+i().hash(t)]=n:i().isImmutable(e)&&void 0!==t&&(this.cache[i().hash(e)]=t)}},{key:"get",value:function(e,t){return i().isImmutable(e)&&i().isImmutable(t)?this.cache[i().hash(e)+"_"+i().hash(t)]:i().isImmutable(e)&&void 0===t?this.cache[i().hash(e)]:null}},{key:"clear",value:function(){this.cache={}}}])&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(e.prototype,t),e}());function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var f=Object.prototype.toString,c=function(e){return"object"===l(e)&&(i().isImmutable(e)||Array.isArray(e)||function(e){if(!e||"object"!==l(e)||"[object Object]"!==f.call(e))return!1;if(null===(e=Object.getPrototypeOf(e)))return!0;for(var t=e,n=Object.getPrototypeOf(e);null!==n;)t=n,n=Object.getPrototypeOf(t);return t===e}(e))};function s(e){return"string"==typeof e||"number"==typeof e||"symbol"===l(e)||"boolean"==typeof e||null==e}function p(e,t){var n=1<arguments.length&&void 0!==t&&t;if(i().isImmutable(e)){if(t=e.toString(),!n)return"Immutable "+t.split(" ")[0];if(0==t.indexOf("Map"))return"object";if(0==t.indexOf("List"))return"array";e=e.toJS()}return u()(e)}o();var d=function(e){return null==e};function m(e){var t=0;return c(e)?(e=i().fromJS(e),a.get(e)?a.get(e):(e.map((function(e){t+=m(e)})),t&&a.set(e,t),t)):1}var y=function(e){if(function(e){return"object"===("undefined"==typeof HTMLElement?"undefined":l(HTMLElement))?e instanceof HTMLElement:e&&"object"===l(e)&&(1===e.nodeType||9===e.nodeType)&&"string"==typeof e.nodeName}(e)||s(e))return e;if(i().isImmutable(e))return e;var t=i().fromJS(e);return i().isImmutable(t)?t:n.unImmutableData.copy(e)};function b(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function v(e,t,n){return t&&h(e.prototype,t),n&&h(e,n),e}function g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var O=new(function(){function e(){b(this,e),g(this,"logs",[])}return v(e,[{key:"push",value:function(e){this.logs.push(e)}},{key:"remove",value:function(e){this.logs=this.logs.filter((function(t){return"init"==t.operation||!1!==e(t)}))}},{key:"update",value:function(e){this.logs=this.logs.map((function(t){return e(t)||t}))}},{key:"check",value:function(){return this.logs.filter((function(e){return"init"!=e.operation}))}},{key:"init",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];if(!Array.isArray(e))throw new Error("请输入正确的log");this.logs=e}}]),e}());const S=new(function(){function e(){b(this,e),g(this,"cache",{add:null,del:null,update:null}),O.init()}return v(e,[{key:"add",value:function(e){O.push(e)}},{key:"init",value:function(e){O.init(),O.push({operation:"init",value:e})}},{key:"getDiffs",value:function(){var e=O.check();return e.toString=function(){return JSON.stringify(e.map((function(e){return i().fromJS(e).toJS()})))},e}},{key:"setLogs",value:function(e){O.init(e)}}]),e}());function j(e,t){var n,r=Object.keys(e);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(e),t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)),r}function k(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?j(Object(n),!0).forEach((function(t){var r,i;r=e,t=n[i=t],i in r?Object.defineProperty(r,i,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[i]=t})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):j(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function I(e,t){for(var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:function(e,t){return e===t},r=e.size,i=t.size,o={1:0},u={0:{1:0}},a=0;a<=r+i;a++){for(var l={},f=-a;f<=a;f+=2){for(var c=f==-a||f!=a&&o[f+1]>o[f-1],s=c?f+1:f-1,p=o[s],d=p=c?p:p+1,m=p-f;d<r&&m<i&&n(e.get(d),t.get(m));)d++,m++;if(o[f]=d,(l[f]=d)==r&&m==i)return u[a]=l,function(e,t,n){var r=[],i=0;return e.forEach((function(e,o){var u=e[0],a=e[1],l=e[2],f=u;if(0===o&&0!==u)for(var c=0;c<u;c++)r.push({operation:"",value:t.get(c),index:[c,i]}),i++;a-u==1?(r.push({operation:"del",value:t.get(u),index:[u,i]}),f=a):(r.push({operation:"add",value:n.get(i),index:[u,i]}),i++);for(var s=0;s<l-f;s++)r.push({operation:"",value:t.get(f+s),index:[f+s,i]}),i++})),r}(function(e,t,n,r){for(var i=[],o={x:t,y:n};0<r;r--){var u=e[r],a=e[r-1],l=o.x-o.y,f=u[l],c=(u=(a=a[u=(c=l==-r||l!=r&&a[1+l]>a[l-1])?1+l:l-1])-u,c?a:a+1);i.unshift([a,c,f]),o.x=a,o.y=u}return i}(u,r,i,a),e,t)}u[a]=l}}var w=function(e,t,r,i,o){var u=I(e,t,(function(e,t){return s(e)||s(t)?e===t:"Immutable Map"==p(e)&&"Immutable Map"==p(t)&&e.get(n.list.key)&&t.get(n.list.key)?e.get(n.list.key)===t.get(n.list.key):M(e,t).similarity>=n.list.mapSimilarityForDiff}));return u.length?(u.forEach((function(n){n.operation||"Immutable Map"!=p(n.value)&&"Immutable List"!=p(n.value)||J(e.get(n.index[0]),t.get(n.index[1]))||o(e.get(n.index[0]),t.get(n.index[1]),r.push(n.index[0]),i.push(p(e.get(n.index[0]),!0)),o)})),S.add({path:r,type:i,operation:"myers-diff",steps:function(e){for(var t=[],n=0;n<e.length;n++){var r=e[n],i=e[n+1];"del"==(null==r?void 0:r.operation)&&"add"==(null==i?void 0:i.operation)&&r.index[1]==i.index[1]&&i.index[0]==i.index[1]?(t.push(k(k({},r),{},{value:[r.value,i.value],operation:"update"})),n++):null!=r&&r.operation&&t.push(r)}return t}(u)})):(e.length||e.size)&&e.map((function(e,n){J(e,t.get(n))||o(e,t.get(n),r.push(n),i.push(p(e,!0)),o)})),u},x=function(e,t){return s(e)||s(t)?e===t:i().isImmutable(e)&&i().isImmutable(t)?i().is(e,t):(i().isImmutable(e)&&(e=e.toJS()),i().isImmutable(t)&&(t=t.toJS()),n.unImmutableData.equal(e,t))};function P(e,t){var r,i,o,u,a=0,l=0,f=0;return t=I(e,t,(function(e,t){return s(e)||s(t)?e===t:"Immutable Map"==p(e)&&"Immutable Map"==p(t)&&e.get(n.list.key)&&t.get(n.list.key)?e.get(n.list.key)===t.get(n.list.key):M(e,t).similarity>=n.list.mapSimilarityForDiff})),{unchanged:f+=(e=e,u=o=i=r=0,(t=t).length?t.forEach((function(e){e.operation?"add"==e.operation?i++:"del"==e.operation?o+=m(e.value):"update"==e.operation&&(u+=m(e.value)):r+=m(e.value)})):r=m(e),e=Math.round(r/(i+o+u+r)*100)/100,e={unchanged:r,add:i,del:o,update:u,changed:0,similarity:e}).unchanged,add:a+=e.add,del:l+=e.del,update:0,changed:a+l+0,similarity:Math.round(f/(a+l+0+f)*100)/100}}function M(e,t){return r=t,O=g=v=h=0,c(n=e)?(n=i().fromJS(n),r=i().fromJS(r),p(n)==p(r)?((o=a.get(n,r))||("Immutable Map"==p(n)?(u=n,y=s=f=l=0,b={},r.map((function(e,t){d(e)||(b[t]=e,d(u.get(t))&&f++)})),u.map((function(e,t){d(e)||(d(b[t])?c(e)?s+=m(e):s++:i().is(e,b[t])?y+=m(e):(t=M(e,b[t]),l+=t.update,s+=t.del,f+=t.add,y+=t.unchanged))})),o={unchanged:y,add:f,del:s,update:l,changed:f+s+l,similarity:Math.round(y/(f+s+l+y)*100)/100}):"Immutable List"==p(n)&&(o=P(n,r)),a.set(n,r,o)),h+=o.update,v+=o.add,g+=o.del,O+=o.unchanged):h+=m(n)):n===r?O+=1:h+=1,{unchanged:O,add:v,del:g,update:h,changed:v+g+h,similarity:Math.round(O/(v+g+h+O)*100)/100};var n,r,o,u,l,f,s,y,b,h,v,g,O}function J(e,t){return i().is(e,t)}function T(e,t,n,r,o){if(c(e)&&c(t)){if(e=i().fromJS(e),t=i().fromJS(t),i().is(e,t))return;var u=p(e);if(u==p(t))return void("Immutable List"==u?w(e,t,n,r,o):"Immutable Map"==u&&(a=e,f=n,s=r,m=o,(l=t).map((function(e,t){d(e)||d(a.get(t))&&S.add({path:f.push(t),operation:"add",type:s.push(p(a,!0)),value:{from:void 0,to:y(l.get(t))}})})),a.map((function(e,t){var n=l.get(t+="");d(e)||x(e,n)||(d(n)?S.add({path:f.push(t),operation:"delete",type:s.push(p(a,!0)),value:{from:y(e),to:void 0}}):m(e,n,f.push(t),s.push(p(a,!0)),m))}))))}var a,l,f,s,m;x(e,t)||S.add({path:n,type:r.push(p(e,!0)),operation:"update",value:{from:y(e),to:y(t)}})}function D(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return e=i().fromJS(e),S.init(e),n.set(r),T(e,i().fromJS(t),i().List([]),i().List([]),T),S}function E(e){return(E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}r=void 0,o=function(e){e.default={diff:D,similarity:M},e.diff=D,e.similarity=M},"object"===("undefined"==typeof exports?"undefined":E(exports))?o(exports):"function"==typeof define&&e.amdO?define(["exports"],o):o((r="undefined"!=typeof globalThis?globalThis:r||self).TreeDiff={})})();