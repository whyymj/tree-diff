/*! For license information please see index.js.LICENSE.txt */
(()=>{"use strict";var e=[e=>{function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e){return!(!(n=e)||"object"!==t(n)||(n=e,"[object RegExp]"===(e=Object.prototype.toString.call(n))||"[object Date]"===e||function(e){return e.$$typeof===r}(n)));var n}var r="function"==typeof Symbol&&Symbol.for?Symbol.for("react.element"):60103;function o(e,t){return!1!==t.clone&&t.isMergeableObject(e)?f(Array.isArray(e)?[]:{},e,t):e}function i(e,t,n){return e.concat(t).map((function(e){return o(e,n)}))}function u(e){return Object.keys(e).concat((t=e,Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(t).filter((function(e){return t.propertyIsEnumerable(e)})):[]));var t}function a(e,t){try{return t in e}catch(e){return!1}}function l(e,t,n){var r={};return n.isMergeableObject(e)&&u(e).forEach((function(t){r[t]=o(e[t],n)})),u(t).forEach((function(i){var u,l;(!a(u=e,l=i)||Object.hasOwnProperty.call(u,l)&&Object.propertyIsEnumerable.call(u,l))&&(a(e,i)&&n.isMergeableObject(t[i])?r[i]=(u=i,((l=n).customMerge&&"function"==typeof(u=l.customMerge(u))?u:f)(e[i],t[i],n)):r[i]=o(t[i],n))})),r}function f(e,t,r){(r=r||{}).arrayMerge=r.arrayMerge||i,r.isMergeableObject=r.isMergeableObject||n,r.cloneUnlessOtherwiseSpecified=o;var u=Array.isArray(t);return u===Array.isArray(e)?u?r.arrayMerge(e,t,r):l(e,t,r):o(t,r)}f.all=function(e,t){if(!Array.isArray(e))throw new Error("first argument should be an array");return e.reduce((function(e,n){return f(e,n,t)}),{})},e.exports=f}],t={};function n(r){var o=t[r];return void 0!==o||(o=t[r]={exports:{}},e[r](o,o.exports,n)),o.exports}n.amdO={},n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};(()=>{n.r(r);var e=n(0),t=n.n(e);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const i=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),o(this,"unImmutableData",{equal:function(e,t){return e===t},copy:function(e){return e},merge:function(e,n){t()(e,n)}}),o(this,"list",{key:"_id",mapSimilarityForDiff:.6})}var n;return(n=[{key:"set",value:function(e){}}])&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(e.prototype,n),e}());var u=require("immutable"),a=n.n(u),l=(e=require("kind-of"),n.n(e));u=require("isobject"),e=n.n(u);const f=new(function(){function e(){var t,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),n={},(t="cache")in this?Object.defineProperty(this,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):this[t]=n}var t;return(t=[{key:"set",value:function(e,t,n){a().isImmutable(e)&&a().isImmutable(t)?this.cache[a().hash(e)+"_"+a().hash(t)]=n:a().isImmutable(e)&&void 0!==t&&(this.cache[a().hash(e)]=t)}},{key:"get",value:function(e,t){return a().isImmutable(e)&&a().isImmutable(t)?this.cache[a().hash(e)+"_"+a().hash(t)]:a().isImmutable(e)&&void 0===t?this.cache[a().hash(e)]:null}},{key:"clear",value:function(){this.cache={}}}])&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(e.prototype,t),e}());function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var s=Object.prototype.toString,p=function(e){return"object"===c(e)&&(a().isImmutable(e)||Array.isArray(e)||function(e){if(!e||"object"!==c(e)||"[object Object]"!==s.call(e))return!1;if(null===(e=Object.getPrototypeOf(e)))return!0;for(var t=e,n=Object.getPrototypeOf(e);null!==n;)t=n,n=Object.getPrototypeOf(t);return t===e}(e))};function y(e){return"string"==typeof e||"number"==typeof e||"symbol"===c(e)||"boolean"==typeof e||null==e}function d(e,t){var n=1<arguments.length&&void 0!==t&&t;if(a().isImmutable(e)){if(t=e.toString(),!n)return"Immutable "+t.split(" ")[0];if(0==t.indexOf("Map"))return"object";if(0==t.indexOf("List"))return"array";e=e.toJS()}return l()(e)}e();var m=function(e){return null==e};function b(e){var t=0;return p(e)?(e=a().fromJS(e),f.get(e)?f.get(e):(e.map((function(e){t+=b(e)})),t&&f.set(e,t),t)):1}var g=function(e){if(function(e){return"object"===("undefined"==typeof HTMLElement?"undefined":c(HTMLElement))?e instanceof HTMLElement:e&&"object"===c(e)&&(1===e.nodeType||9===e.nodeType)&&"string"==typeof e.nodeName}(e)||y(e))return e;if(a().isImmutable(e))return e;var t=a().fromJS(e);return a().isImmutable(t)?t:i.unImmutableData.copy(e)};function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function v(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function S(e,t,n){return t&&v(e.prototype,t),n&&v(e,n),e}function j(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function O(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function I(e){return(I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function M(e,t,n){var r=0<arguments.length&&void 0!==e?e:{},o=(t=1<arguments.length?t:void 0,2<arguments.length&&void 0!==n?n:["add","update"]);if("object"!=I(r))throw new Error("请输入Object");return(t=Array.isArray(t)?t:[t]).map((function(e){var t,n,i;o.includes(e.operation)&&(t=e.path,n=e.type,i=r,t.map((function(t,r){"object"==(r=a().isImmutable(n)?n.get(r+1):n[r+1])||"array"==r?(i[t]||(i[t]={}),i=i[t]):i[t]=a().isImmutable(e.value.to)?e.value.to.toJS():e.value.to})))})),r}var w=new(function(){function e(){h(this,e),j(this,"mergeLog",{delete:[]}),j(this,"logs",[])}return S(e,[{key:"push",value:function(e){switch(e.operation){case"add":return void(this.mergeLog.add=M(this.mergeLog.add,e,["add"]));case"update":return void(this.mergeLog.update=M(this.mergeLog.update,e,["update"]));case"delete":return void this.mergeLog.delete.push(e.path);case"myers-diff":return void this.logs.push([e.operation,e.path,e.steps]);case"init":return void this.logs.push([e.operation,e.steps])}}},{key:"remove",value:function(e){this.logs=this.logs.filter((function(t){return!1!==e(t)}))}},{key:"update",value:function(e){this.logs=this.logs.map((function(t){return e(t)||t}))}},{key:"getDiff",value:function(){return this.getLogs().filter((function(e){return"init"!=e[0]}))}},{key:"getLogs",value:function(){var e=this.logs;return this.mergeLog.delete.length&&e.unshift(["del"].concat(function(e){return function(e){if(Array.isArray(e))return O(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return O(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(n="Object"===n&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?O(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(this.mergeLog.delete))),this.mergeLog.add&&e.unshift(["add",this.mergeLog.add]),this.mergeLog.update&&e.unshift(["update",this.mergeLog.update]),e}},{key:"init",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];if(!Array.isArray(e))throw new Error("请输入正确的log");this.logs=e}}]),e}());function k(){return JSON.stringify(this.map((function(e){return a().fromJS(e).toJS()})))}const x=new(function(){function e(){h(this,e),w.init()}return S(e,[{key:"reset",value:function(){return M(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},1<arguments.length?arguments[1]:void 0)}},{key:"add",value:function(e){w.push(e)}},{key:"init",value:function(e){w.init(),w.push({operation:"init",value:e})}},{key:"getDiff",value:function(){var e=w.getDiff();return e.toString=k,e}},{key:"setLogs",value:function(e){w.init(e)}}]),e}());function L(e,t){for(var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:function(e,t){return e===t},r=e.size,o=t.size,i={1:0},u={0:{1:0}},a=0;a<=r+o;a++){for(var l={},f=-a;f<=a;f+=2){for(var c=f==-a||f!=a&&i[f+1]>i[f-1],s=c?f+1:f-1,p=i[s],y=p=c?p:p+1,d=p-f;y<r&&d<o&&n(e.get(y),t.get(d));)y++,d++;if(i[f]=y,(l[f]=y)==r&&d==o)return u[a]=l,function(e,t,n){var r=[],o=0;return e.forEach((function(e,i){var u=e[0],a=e[1],l=e[2],f=u;if(0===i&&0!==u)for(var c=0;c<u;c++)r.push({operation:"",value:t.get(c),index:[c,o]}),o++;a-u==1?(r.push({operation:"del",value:t.get(u),index:[u,o]}),f=a):(r.push({operation:"add",value:n.get(o),index:[u,o]}),o++);for(var s=0;s<l-f;s++)r.push({operation:"",value:t.get(f+s),index:[f+s,o]}),o++})),r}(function(e,t,n,r){for(var o=[],i={x:t,y:n};0<r;r--){var u=e[r],a=e[r-1],l=i.x-i.y,f=u[l],c=(u=(a=a[u=(c=l==-r||l!=r&&a[1+l]>a[l-1])?1+l:l-1])-u,c?a:a+1);o.unshift([a,c,f]),i.x=a,i.y=u}return o}(u,r,o,a),e,t)}u[a]=l}}var A=function(e,t,n,r,o){var u=L(e,t,(function(e,t){return y(e)||y(t)?e===t:"Immutable Map"==d(e)&&"Immutable Map"==d(t)&&e.get(i.list.key)&&t.get(i.list.key)?e.get(i.list.key)===t.get(i.list.key):J(e,t).similarity>=i.list.mapSimilarityForDiff}));u.length?(u.forEach((function(i){i.operation||"Immutable Map"!=d(i.value)&&"Immutable List"!=d(i.value)||T(e.get(i.index[0]),t.get(i.index[1]))||o(e.get(i.index[0]),t.get(i.index[1]),n.push(i.index[0]),r,o)})),x.add({path:n,type:r,operation:"myers-diff",steps:function(e){for(var t=[],n=0;n<e.length;n++){var r,o=e[n],i=e[n+1];"del"==(null==o?void 0:o.operation)&&"add"==(null==i?void 0:i.operation)&&o.index[1]==i.index[1]?(t.push(["update",o.index[0],i.value]),n++):null!=o&&o.operation&&(i=[o.operation,o.index[0]],"add"==(null==o?void 0:o.operation)?("add"==(null===(r=t[t.length-1])||void 0===r?void 0:r[0])&&t[t.length-1][1]==o.index[0]?i=t[t.length-1]:t.push(i),i.push(o.value)):"del"==(null==o?void 0:o.operation)&&"del"==(null===(r=t[t.length-1])||void 0===r?void 0:r[0])?(i=t[t.length-1]).push(o.index[0]):t.push(i))}return t}(u)})):(e.length||e.size)&&e.map((function(e,i){T(e,t.get(i))||o(e,t.get(i),n.push(i),r,o)}))},E=function(e,t){return y(e)||y(t)?e===t:a().isImmutable(e)&&a().isImmutable(t)?a().is(e,t):(a().isImmutable(e)&&(e=e.toJS()),a().isImmutable(t)&&(t=t.toJS()),i.unImmutableData.equal(e,t))};function P(e,t){var n,r,o,u,a=0,l=0,f=0;return t=L(e,t,(function(e,t){return y(e)||y(t)?e===t:"Immutable Map"==d(e)&&"Immutable Map"==d(t)&&e.get(i.list.key)&&t.get(i.list.key)?e.get(i.list.key)===t.get(i.list.key):J(e,t).similarity>=i.list.mapSimilarityForDiff})),{unchanged:f+=(e=e,u=o=r=n=0,(t=t).length?t.forEach((function(e){e.operation?"add"==e.operation?r++:"del"==e.operation?o+=b(e.value):"update"==e.operation&&(u+=b(e.value)):n+=b(e.value)})):n=b(e),e=Math.round(n/(r+o+u+n)*100)/100,e={unchanged:n,add:r,del:o,update:u,changed:0,similarity:e}).unchanged,add:a+=e.add,del:l+=e.del,update:0,changed:a+l+0,similarity:Math.round(f/(a+l+0+f)*100)/100}}function J(e,t){return r=t,S=v=h=g=0,p(n=e)?(n=a().fromJS(n),r=a().fromJS(r),d(n)==d(r)?((o=f.get(n,r))||("Immutable Map"==d(n)?(i=n,s=c=l=u=0,y={},r.map((function(e,t){m(e)||(y[t]=e,m(i.get(t))&&l++)})),i.map((function(e,t){m(e)||(m(y[t])?p(e)?c+=b(e):c++:a().is(e,y[t])?s+=b(e):(t=J(e,y[t]),u+=t.update,c+=t.del,l+=t.add,s+=t.unchanged))})),o={unchanged:s,add:l,del:c,update:u,changed:l+c+u,similarity:Math.round(s/(l+c+u+s)*100)/100}):"Immutable List"==d(n)&&(o=P(n,r)),f.set(n,r,o)),g+=o.update,h+=o.add,v+=o.del,S+=o.unchanged):g+=b(n)):n===r?S+=1:g+=1,{unchanged:S,add:h,del:v,update:g,changed:h+v+g,similarity:Math.round(S/(h+v+g+S)*100)/100};var n,r,o,i,u,l,c,s,y,g,h,v,S}function T(e,t){return a().is(e,t)}function D(e,t,n,r,o){if(p(e)&&p(t)){if(e=a().fromJS(e),t=a().fromJS(t),a().is(e,t))return;var i=d(e);if(i==d(t))return void("Immutable List"==i?A(e,t,n,r.push(d(e,!0)),o):"Immutable Map"==i&&(u=e,l=t,f=n,c=r.push(d(e,!0)),s=o,l.map((function(e,t){m(e)||m(u.get(t))&&x.add({path:f.push(t),operation:"add",type:c,value:{from:void 0,to:g(l.get(t))}})})),u.map((function(e,t){var n=l.get(t+="");m(e)||E(e,n)||(m(n)?x.add({path:f.push(t),operation:"delete",type:c.push(d(e,!0)),value:{from:g(e),to:void 0}}):s(e,n,f.push(t),c,s))}))))}var u,l,f,c,s;E(e,t)||x.add({path:n,type:r.push(d(e,!0)),operation:"update",value:{from:g(e),to:g(t)}})}function _(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return e=a().fromJS(e),x.init(e),i.set(n),D(e,a().fromJS(t),a().List([]),a().List([]),D),x}function q(e){return(q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function $(e){return!(!(t=e)||"object"!==q(t)||(t=e,"[object RegExp]"===(e=Object.prototype.toString.call(t))||"[object Date]"===e||function(e){return e.$$typeof===C}(t)));var t}var C="function"==typeof Symbol&&Symbol.for?Symbol.for("react.element"):60103;function z(e,t){return!1!==t.clone&&t.isMergeableObject(e)?N(Array.isArray(e)?[]:{},e,t):e}function F(e){return Object.keys(e).concat((t=e,Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(t).filter((function(e){return t.propertyIsEnumerable(e)})):[]));var t}function H(e,t){try{return t in e}catch(e){return!1}}function N(e,t,n){return(n=n||{}).isMergeableObject=n.isMergeableObject||$,function(e,t,n){var r=e||{};return n.isMergeableObject(e)&&F(e).forEach((function(t){r[t]=z(e[t],n)})),F(t).forEach((function(o){var i,u;(!H(i=e,u=o)||Object.hasOwnProperty.call(i,u)&&Object.propertyIsEnumerable.call(i,u))&&(H(e,o)&&n.isMergeableObject(t[o])?r[o]=(i=o,((u=n).customMerge&&"function"==typeof(i=u.customMerge(i))?i:N)(e[o],t[o],n)):r[o]=z(t[o],n))})),r}(e,t,n)}function R(e){return(R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}u=void 0,e=function(e){var t={diff:_,similarity:J,deepmerge:N,log:x};e.default=t,e.diff=_,e.deepmerge=N,e.similarity=J,e.log=x},"object"===("undefined"==typeof exports?"undefined":R(exports))?e(exports):"function"==typeof define&&n.amdO?define(["exports"],e):e((u="undefined"!=typeof globalThis?globalThis:u||self).TreeDiff={})})()})();